<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…Ø­Ù„ Ø§Ù„Ø¥Ø®ÙˆØ© Ù…Ø²ÙˆØ§Ø±</title>

{% load static %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>

<body>

<!-- ===== HERO SECTION ===== -->
<div class="hero">

    <img src="{% static 'images/logo.png' %}" class="hero-logo">

    <h1>ğŸ¥•ğŸ Ù…Ø­Ù„ Ø§Ù„Ø¥Ø®ÙˆØ© Ù…Ø²ÙˆØ§Ø±</h1>
    <p>Ø®Ø¶Ø± ÙˆÙÙˆØ§ÙƒÙ‡ Ø·Ø§Ø²Ø¬Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ø¨Ø§Ø¨ Ù…Ù†Ø²Ù„Ùƒ</p>

    <a href="#shop" class="start-btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù† ğŸ›’</a>

    <div class="down-arrow">â¬‡</div>
</div>

<!-- ===== SLIDER SECTION ===== -->
<div class="slider">
    <div class="slides">
        <img src="{% static 'images/slider_welcome.png' %}">
        <img src="{% static 'images/slider_1.png' %}">
        <img src="{% static 'images/slider_2.png' %}">
        <img src="{% static 'images/slider_3.png' %}">
    </div>
</div>

<!-- ===== SEARCH ===== -->
<div id="shop" class="search-box">
    <form method="get" style="display:flex;width:100%;">
        <input type="text" name="q" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªÙˆØ¬...">
        <button type="submit">ğŸ”</button>
    </form>
</div>


<div class="container">

{% regroup products by category as category_list %}

{% for cat in category_list %}

    <div class="category-title">
        ğŸ¥¬ {{ cat.grouper.name }}
    </div>

    <div class="products">

    {% for product in cat.list %}

    <div class="card">

        <!-- âœ… Badge Ù…ØªÙˆÙØ± / ØºÙŠØ± Ù…ØªÙˆÙØ± -->
        {% if product.available %}
            <div class="badge available">âœ… Ù…ØªÙˆÙØ±</div>
        {% else %}
            <div class="badge unavailable">âŒ ØºÙŠØ± Ù…ØªÙˆÙØ±</div>
        {% endif %}

        <img src="{{ product.image.url }}">

        <div class="content">
            <h3>{{ product.name }}</h3>

            <div class="price">
                {{ product.price }} Ø¯Ø¬ /
                {% if product.sell_unit == 'kg' %}ÙƒØº{% else %}Ù‚Ø·Ø¹Ø©{% endif %}
            </div>

            <!-- âœ… Ø¥Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ±: Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¶Ø§ÙØ© -->
            {% if product.available %}

            <form method="post" action="{% url 'cart_add' product.id %}">
                {% csrf_token %}

                <div class="qty-box" data-step="{{ product.step }}">
                    <button type="button" onclick="changeQty(this,-1)">âˆ’</button>

                    <input
                        type="number"
                        name="quantity"
                        value="{{ product.step }}"
                        step="{{ product.step }}"
                        min="{{ product.step }}"
                    >

                    <button type="button" onclick="changeQty(this,1)">+</button>
                </div>

                <button type="submit" class="add-btn">
                    ğŸ›’ Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©
                </button>
            </form>

            {% else %}

            <button class="add-btn disabled" disabled>
                âŒ ØºÙŠØ± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§
            </button>

            {% endif %}

        </div>
    </div>

    {% endfor %}

    </div>

{% endfor %}

</div>


<a href="{% url 'cart_detail' %}" class="cart-btn">
ğŸ›’ Ø§Ù„Ø³Ù„Ø©
</a>


<script>
function changeQty(btn, direction) {
    const box = btn.closest(".qty-box");
    const input = box.querySelector("input");
    const step = parseFloat(box.dataset.step);

    let value = parseFloat(input.value);
    value += step * direction;

    if(value < step) value = step;

    input.value = value.toFixed(1);
}
</script>

</body>
</html>