<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…Ø­Ù„ Ø§Ù„Ø¥Ø®ÙˆØ© Ù…Ø²ÙˆØ§Ø± - Ø®Ø¶Ø± Ùˆ ÙÙˆØ§ÙƒÙ‡</title>

{% load static %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>

<body>

<div class="header">
    <h1>ğŸ¥•ğŸ Ù…Ø­Ù„ Ø§Ù„Ø¥Ø®ÙˆØ© Ù…Ø²ÙˆØ§Ø±</h1>
    <p>Ø®Ø¶Ø± ÙˆÙÙˆØ§ÙƒÙ‡ Ø·Ø§Ø²Ø¬Ø©</p>
</div>

<div class="container">
<div class="products">

{% for product in products %}

<form method="post" action="{% url 'cart_add' product.id %}">
{% csrf_token %}

<div class="card">

    <img src="{{ product.image.url }}">

    <div class="content">

        <h3>{{ product.name }}</h3>

        <div class="price">
         Ø§Ù„Ø³Ø¹Ø± Ù„Ù„ÙˆØ­Ø¯Ø©:
         {{ product.price }} Ø¯Ø¬ /
         {% if product.sell_unit == 'kg' %}ÙƒØº{% else %}Ù‚Ø·Ø¹Ø©{% endif %}
         </div>

         <!-- âœ… Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ -->
         <div class="total-price" id="price-{{ product.id }}">
         {{ product.price }} Ø¯Ø¬
        </div>

        <!-- âœ… ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø© -->
        <div class="qty-box" data-step="{{ product.step }}">
            <button type="button" onclick="changeQty(this, -1)">âˆ’</button>

            <input
                type="number"
                name="quantity"
                value="{{ product.step }}"
                step="{{ product.step }}"
                min="{{ product.step }}"
                data-price="{{ product.price }}"
                data-product="{{ product.id }}"
                oninput="updatePrice(this)"
            >

            <button type="button" onclick="changeQty(this, 1)">+</button>
        </div>

        <button type="submit" class="add-btn">
         ğŸ›’ Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©
        </button>

    </div>
</div>

</form>

{% endfor %}

</div>
</div>

<a href="{% url 'cart_detail' %}" class="cart-btn">
ğŸ›’ Ø§Ù„Ø³Ù„Ø©
</a>

<script>
function updatePrice(input) {
    const price = parseFloat(input.dataset.price);
    const qty = parseFloat(input.value);
    const id = input.dataset.product;

    const total = price * qty;

    document.getElementById("price-" + id).innerText =
        total.toFixed(0) + " Ø¯Ø¬";
}

function changeQty(btn, direction) {
    const box = btn.closest('.qty-box');
    const input = box.querySelector('input');
    const step = parseFloat(box.dataset.step);

    let value = parseFloat(input.value);
    value = value + (step * direction);

    if (value < step) value = step;

    input.value = value.toFixed(1);

    updatePrice(input); // ğŸ”¥ Ù…Ù‡Ù… Ø¬Ø¯Ø§
}
</script>

</body>
</html>